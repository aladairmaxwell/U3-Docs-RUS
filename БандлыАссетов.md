Бандлы Ассетов
=============

Игра загружает из Unity __Бандлов Ассетов__ текстуры, аудио, модели, префабы, и т.д. на запуске. С годами они прогрессировали, начиная от индивидуальных *.unity3d бандлов до .content и .masterbundle.

[Мастер Бандлы](#master-bundles) следует использовать непосредственно для всех новых проектов.

Настройка Инструментов
----------

Чтобы начать использовать какие-либо из этих инструментов, сперва они должны быть импортированы в проект Unity.

1. В самом Unity откройте Assets > Import Package > Custom Package... откроется мастер выбора.
1. Найдите папку с игрой.
3. Открывайте папку Bundles/Sources.
4. Импортируйте Project.unitypackage.

Индивидуальные Бандлы Ассетов (*.unity3d)
-----------------------------------

Большинство официальных файлов перешли на систему мастер бандлов, но некоторые из них всё ещё используют их, например текстуры дорог на картах.

### Использование Иструмента:

1. Следуйте инструкции _Настройки Инструментов_.
2. Откройте инструмент через меню Window > Unturned > Bundle Tool.
3. Выберете индивидуальные ассеты или целые директории ассетов в окне Проекта.
4. Щелкните Grab чтобы сделать предпоказ ассетов, которые будут экспортированы.
5. Щелкните Bundle, чтобы выбрать куда экспортировать файл бандла ассета.

### Мотивация:

Когда началась разработка 3.0, ключевым аспектом было поддерживать загрузку кастомного, модового контента. В то время файлы грузились без всяких расширений, поэтому каждый игровой тип искал ключевые названия, такие как "Item", "Object", "Animal", etc. Расширение .unity3d было выбрано для совместимости с веб-браузером. Как видно, эта система провалилась.

Бандлы Контента (*.content)
---------------------------

Этот формат используется ландшафтом девкита, палитрами материалов и песнями для радио, но вряд ли он будет использоваться где-либо ещё, потому что есть мастер бандлы. В идеале, использование этого формата вскоре будет переведено на мастер бандл.

### Использование Инструмента:

1. Следуйте инструкции _Настройки Инструментов_.
2. Откройте инструмент через меню Window > Unturned > Content Tool.
3. Выберете директории ассетов в окне Проекта.
4. В окне Просмотра дайте дайте директории любое название, оканчивающееся на ".content".
5. Щелкните на ..., чтобы выбрать выбрать куда экспортировать файл бандла контента.
6. Щелкните Export.

### Мотивация:

В конце 2016 и начале 2017, разработка была нацелена на улучшение пользования редактором, и один из аспектов являлся бандлинг ассетов. Бандлы контента сканировали манифест содержимых ассетов для того, чтобы можно было в редакторе сделать это самому, и идея заключалась в том, чтобы настраивать каждый контент в самой игре. К сожалению, такая функция оказалась слишком сложной, начиная созданием интерфейса между игровым кодом / подсистемным онлайн кодом, заменяя систему ID на систему GUID'ов. Углубляясь в прошлое, наверное следовало бы выпилить все фишки, созданные для такой системы с того времени.

Мастер Бандлы (*.masterbundle)
-------------------------------

Большинство официальных файлов, включая курированные карты перешло на мастер бандлы, и в дальнейшем всё так и останется.

### Настройка Файла:

Мастер бандлы могут быть загружены, откуда игра способна загрузить файлы *.dat. Однако, если указана перезапись, используется ближайший файл мастер бандла в файловой иерархии. Когда грузится каждая директория, идёт проверка на наличие файла MasterBundle.dat, который сигнализирует о наличии мастер бандла. Например, ссылаясь на core.masterbundle в директории Bundles.

MasterBundle.dat может содержать следующие команды:

	// Название файла бандла ассетов в той же директории, что и файл MasterBundle.dat.
	Asset_Bundle_Name core.masterbundle

	// Путь к бандлу ассетов в самом Unity.
	// Подразделы Unity должны соответствовать 1:1 с подразделами dat.
	Asset_Prefix Assets/CoreMasterBundle

	// Версия 3 это Unity 2018.4 LTS. Более старые версии имеют включённое слияние шейдеров, для обратной совместимости.
	Asset_Bundle_Version 3

Индивидуальные *.dat'ы могут содержать следующие команды:

	// Название мастер бандла, из которого надо загружать файлы.
	Master_Bundle_Override core.masterbundle

	// Если стоит, то вместо этого игра будет искать отдельные *.unity3d бандлы ассетов.
	Exclude_From_Master_Bundle

	// Путь внутри мастер бандла, из которого надо загружать файлы.
	// Используется записками, для деления одного и того же объекта.
	Bundle_Override_Path /Objects/Medium/Furniture/Note

### Использование Инструмента:

1. Следуйте инструкции _Настройки Инструментов_.
2. Откройте инструмент через меню Window > Unturned > Master Bundle Tool.
3. Выберете директории ассетов в окне Проекта.
4. В окне Просмотра дайте дайте директории любое название.
5. Нажмите на галочку рядом с названием бандла ассетов в инструменте, чтобы обозначить его как мастер бандл. Это отфильтрует список бандлов ассетов для показа, а также отследит путь для экспорта, связанный с конкретным бандлом.
6. Щелкните на ..., чтобы выбрать выбрать куда экспортировать файл бандла.
7. Щелкните Export.

### Мотивация:

Когда был переход на Unity 2017.4 LTS, было ясно, что все бандлы ассетов придётся экспортировать из Unity заново, из-за изменения слияния шейдеров. Это будет колоссальный объём файлов, поэтому настало время заново переделать проблему *.content таким образом, что это быстренько переконвертирует весь существующий контент. Это было сделано при помощи сохранения структуры 1:1 и угадывая расширения файла по имени для загрузки.
