Бандлы Ассетов
=============

Игра загружает из Unity __Бандлов Ассетов__ текстуры, аудио, модели, префабы, и т.д. на запуске. С годами они прогрессировали, начиная от индивидуальных *.unity3d бандлов до .content и .masterbundle.

[Мастер Бандлы](#master-bundles) следует использовать непосредственно для всех новых проектов.

Настройка Инструментов
----------

Чтобы начать использовать какие-либо из этих инструментов, сперва они должны быть импортированы в проект Unity.

1. В самом Unity откройте Assets > Import Package > Custom Package... откроется мастер выбора.
1. Найдите папку с игрой.
3. Открывайте папку Bundles/Sources.
4. Импортируйте Project.unitypackage.

Индивидуальные Бандлы Ассетов (*.unity3d)
-----------------------------------

Большинство официальных файлов перешли на систему мастер бандлов, но некоторые из них всё ещё используют их, например текстуры дорог на картах.

### Использование Иструмента:

1. Следуйте инструкции _Настройки Инструментов_.
2. Откройте инструмент через меню Window > Unturned > Bundle Tool.
3. Выберете индивидуальные ассеты или целые директории ассетов в окне Проекта.
4. Щелкните Grab чтобы сделать предпоказ ассетов, которые будут экспортированы.
5. Щелкните Bundle, чтобы выбрать куда экспортировать файл бандла ассета.

### Мотивация:

Когда началась разработка 3.0, ключевым аспектом было поддерживать загрузку кастомного, модового контента. В то время файлы грузились без всяких расширений, поэтому каждый игровой тип искал ключевые названия, такие как "Item", "Object", "Animal", etc. Расширение .unity3d было выбрано для совместимости с веб-браузером. Как видно, эта система провалилась.

Бандлы Контента (*.content)
---------------------------

Этот формат используется ландшафтом девкита, палитрами материалов и песнями для радио, но вряд ли он будет использоваться где-либо ещё, потому что есть мастер бандлы. В идеале, использование этого формата вскоре будет переведено на мастер бандл.

### Использование Инструмента:

1. Следуйте инструкции _Настройки Инструментов_.
2. Откройте инструмент через меню Window > Unturned > Content Tool.
3. Выберете директории ассетов в окне Проекта.
4. В окне Просмотра дайте дайте директории название, оканчивающееся на ".content".
5. Щелкните на ..., чтобы выбрать выбрать куда экспортировать файл бандла контента.
6. Щелкните Export.

### Мотивация:

В конце 2016 и начале 2017, разработка была нацелена на улучшение пользования редактором, и один из аспектов являлся бандлинг ассетов. Бандлы контента сканировали манифест содержимых ассетов для того, чтобы можно было в редакторе сделать это самому, и идея заключалась в том, чтобы настраивать каждый контент в самой игре. К сожалению, такая функция оказалась слишком сложной, начиная созданием интерфейса между игровым кодом / подсистемным онлайн кодом, заменяя систему ID на систему GUID'ов. Углубляясь в прошлое, наверное следовало бы выпилить все фишки, созданные для такой системы с того времени.

Мастер Бандлы (*.masterbundle)
-------------------------------

Большинство официальных файлов, включая курированные карты перешло на мастер бандлы, и в дальнейшем всё так и останется.

### File Setup:

Master bundles can be loaded from any directory the game loads *.dat files from. Unless an override is specified, the nearest master bundle in the file hierarchy is used. While loading each directory is checked for a MasterBundle.dat file signalling the presence of a master bundle. For example, refer to the core.masterbundle in the Bundles directory.

MasterBundle.dat can set the following keys:

	// Name of asset bundle file in the same directory as MasterBundle.dat.
	Asset_Bundle_Name core.masterbundle

	// Path to the asset bundle within Unity.
	// Unity subfolders should match 1:1 with dat subfolders.
	Asset_Prefix Assets/CoreMasterBundle

	// Version 3 is Unity 2018.4 LTS. Older versions have shader consolidation enabled for backwards compatibility.
	Asset_Bundle_Version 3

Individual asset *.dats can set the following keys:

	// Name of master bundle to load files from.
	Master_Bundle_Override core.masterbundle

	// If included, look for an individual *.unity3d asset bundle instead.
	Exclude_From_Master_Bundle

	// Path within master bundle to load files from.
	// Used by notes to share a common object prefab.
	Bundle_Override_Path /Objects/Medium/Furniture/Note

### Tool Usage:

1. Follow _Tool Setup_ instructions.
2. Open the tool from the Window > Unturned > Master Bundle Tool menu.
3. Select directories of assets in the Project window.
4. In the Inspector window tag them in any asset bundle.
5. Click the checkbox next to an asset bundle's name in the tool to mark it as a master bundle. This filters the list of asset bundles to show, and tracks an export path associated with it.
6. Click the ... to choose a destination for the bundle file.
7. Click Export.

### Motivations:

When upgrading to Unity 2017.4 LTS it became apparent that all asset bundles would have to be re-exported from Unity due to shader compatibility changes. This would be an incredible amount of files, so it was time to re-approach the *.content issue in a way that could quickly convert all existing content. This was handled by keeping the file hierarchy 1:1 and guessing the file extension for the by-name loading.
